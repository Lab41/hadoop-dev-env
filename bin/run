#!/bin/sh

set -e

ROOT=$(cd $(dirname "$0")/..; pwd)

hadoop_conf="$1"
shift

if [[ "$hadoop_conf" == "" ]]; then
    echo "please enter the config" 1>&2
    exit 1
fi

case "$hadoop_conf" in
    pseudo)
        CDH=cdh5.0.0
        export HADOOP_CONF_DIR=$ROOT/conf/pseudo
        export YARN_CONF_DIR=$HADOOP_YARN_HOME/conf
        export HADOOP_PREFIX=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        export HADOOP_HOME=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        ;;
    local)
        CDH=cdh5.0.0
        export HADOOP_CONF_DIR=$ROOT/conf/local
        export YARN_CONF_DIR=$HADOOP_YARN_HOME/conf
        export HADOOP_PREFIX=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        export HADOOP_HOME=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        ;;
    vm)
        CDH=cdh5.0.0
        export HADOOP_CONF_DIR=$ROOT/conf/vm
        export YARN_CONF_DIR=$HADOOP_YARN_HOME/conf
        export HADOOP_PREFIX=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        export HADOOP_HOME=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        ;;
    mp)
        CDH=cdh4.4.0
        export HADOOP_CONF_DIR=$ROOT/conf/mp/hadoop-conf
        export YARN_CONF_DIR=$ROOT/conf/mp/yarn-conf
        export HADOOP_PREFIX=$ROOT/cdh/$CDH/hadoop-2.0.0-$CDH
        export HADOOP_HOME=$ROOT/cdh/$CDH/hadoop-2.0.0-$CDH
        ;;
    cdh5)
        CDH=cdh5.0.0
        export HADOOP_CONF_DIR=$ROOT/conf/cdh5
        export YARN_CONF_DIR=$HADOOP_YARN_HOME/conf
        export HADOOP_PREFIX=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        export HADOOP_HOME=$ROOT/cdh/$CDH/hadoop-2.3.0-$CDH
        ;;
    *)
        echo "unknown config $hadoop_conf" 1>&2
        exit 1
        ;;
esac

if [[ "$1" == "" ]]; then
    echo "please specify a command to run" 1>&2
    exit 1
fi

export HADOOP_HDFS_HOME=$HADOOP_HOME
export HADOOP_MAPRED_HOME=$HADOOP_HOME
export HADOOP_YARN_HOME=$HADOOP_HOME
export HADOOP_COMMON_HOME=$HADOOP_HOME
export HBASE_HOME=$ROOT/cdh/$CDH/hbase-0.96.1.1-$CDH
export ZOOKEEPER_HOME=$ROOT/cdh/$CDH/zookeeper-3.4.5-$CDH
export ZOOCFGDIR=$HADOOP_CONF_DIR
export CLASSPATH=$CLASSPATH:$HADOOP_CONF_DIR
export SOLR_ZK_ENSEMBLE=localhost:2181
export SOLR_HDFS_HOME=hdfs://localhost:8020/solr
export SOLR_HOME=$ROOT/cdh/$CDH/solr-4.4.0-$CDH

export PATH=\
$HADOOP_HOME/bin:\
$HADOOP_HOME/sbin:\
$HBASE_HOME/bin:\
$HBASE_HOME/sbin:\
$ZOOKEEPER_HOME/bin:\
$PATH

exec "$@"
