#!/bin/sh

set -e

ROOT=$(cd $(dirname "$0")/..; pwd)

hadoop_conf="$1"
shift

if [[ "$hadoop_conf" == "" ]]; then
    echo "please enter the config" 1>&2
    exit 1
fi

case "$hadoop_conf" in
    pseudo)
        export HADOOP_CONF_DIR=$ROOT/conf/pseudo/
        ;;
    local)
        export HADOOP_CONF_DIR=$ROOT/conf/local/
        ;;
    vm)
        export HADOOP_CONF_DIR=$ROOT/conf/vm/
        ;;
    mp)
        export HADOOP_CONF_DIR=$ROOT/conf/mp/
        ;;
    *)
        echo "unknown config $hadoop_conf" 1>&2
        exit 1
        ;;
esac

if [[ "$1" == "" ]]; then
    echo "please specify a command to run" 1>&2
    exit 1
fi

CDH=cdh5.0.0-beta-2
export HADOOP_PREFIX=$ROOT/cdh/$CDH/hadoop-2.2.0-$CDH
export HADOOP_HOME=$ROOT/cdh/$CDH/hadoop-2.2.0-$CDH
export HADOOP_HDFS_HOME=$HADOOP_HOME
export HADOOP_MAPRED_HOME=$HADOOP_HOME
export HADOOP_YARN_HOME=$HADOOP_HOME
export YARN_CONF_DIR=$HADOOP_YARN_HOME/conf
export HADOOP_COMMON_HOME=$HADOOP_HOME
export HBASE_HOME=$ROOT/cdh/$CDH/hbase-0.96.1.1-$CDH
export CLASSPATH=$CLASSPATH:$HADOOP_CONF_DIR

export PATH=\
$HADOOP_HOME/bin:\
$HADOOP_HOME/sbin:\
$HBASE_HOME/bin:\
$HBASE_HOME/sbin:\
$PATH

exec "$@"
